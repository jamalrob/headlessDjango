{% extends "base.html" %}
{% block body %}

<main>
    <section class="panel">
        <h1>Your writing assistant</h1>
        <ul class="choices">
            {% for c in choices %}
            <li>
                {{ c.message.content }}
            </li>
            {% endfor %}
        </ul>
        <div style="display: flow-root;">
            <textarea id="editBox" style="height: 30vh;padding: 10px 15px;"></textarea>
            <button class="getanswer" id="getanswer">
                <span id="answerAction">Get an alternative</span>
                <div id="answerLoading" class="loading"></div>
            </button>
        </div>

        <div id="answer" style="margin-top: 40px;"></div>
    </section>
    
</main>
<script>
    $(document).ready(function () {

        $('#getanswer').click(function (e) {
            e.preventDefault();
            e.stopPropagation();     
            
            $('#answerAction').hide()
            $('#answerLoading').show()

            const url = '/cms/ai/getanswer/';
            var data = {
                content: $("#editBox").val(),
                csrfmiddlewaretoken: getCookie('csrftoken'),
            }

            $.ajax({
                url: url,
                type: 'POST',
                data: data,
            }).done(function (response) {
                //$(loadingElement).hide();
                $('#answerLoading').hide()
                $('#answerAction').show()
                $('#answer').text(response.answer);
            })            
        })


    })

    // Utility for CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

</script>
{% endblock %}